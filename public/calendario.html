<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CALENDÁRIO | Mooca Solidária</title>
    <link rel="shortcut icon" href="./assets/imgs/favicon-tfg.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./css/calendario.css">
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="stylesheet" href="./css/all.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="./js/functions.js"></script>
    <script src="js/DashBoard/calendario.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/login.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

</head>

<body onload="carregarInformacoes()">

    <div class="container-principal">
        <div class="sidebar">
            <div class="container-sidebar">

                <div class="container-logo">
                    <img width="auto" height="80" src="./assets/imgs/logo-mooca.png" alt="">
                </div>

                <div class="sidebar-options">
                    <div class="opt">
                        <div class="icon-opt">
                            <img src="./assets/imgs/icons8-casa-30.png" alt="">
                        </div>
                        <a href="dash-requisicoes.html">Home </a>
                    </div>
                    <div class="opt">
                        <div class="icon-opt">
                            <img src="./assets/imgs/icons8-saco-de-dinheiro-30.png" alt="">
                        </div>
                        <a href="financeiro.html">Bazar </a>
                    </div>
                    <div class="opt">
                        <div class="icon-opt">
                            <img src="./assets/imgs/icons8-bem-estar-50.png" alt="">
                        </div>
                        <a href="doacoes.html">Doações </a>
                    </div>
                    <div class="opt" id="opt-highlight">
                        <div class="icon-opt">
                            <img src="./assets/imgs/icons8-calendário-30.png" alt="">
                        </div>
                        <a href="calendario.html">Calendário </a>
                    </div>
                </div>

                <div class="logoff">
                    <img src="./assets/imgs/icons8-sair-30 (1).png" alt="">
                    <p onclick="Logout(sessionStorage.getItem('ID_USER'))">Sair</p>
                </div>

            </div>
        </div>


        <div class="content">
            <div class="navbar">
                <div class="container-navbar">
                    <div class="hamburger-menu" id="hamburger-menu">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                    <p>Calendário de ações</p>
                    <div class="user">
                        <img width="auto" height="35" src="./assets/imgs/icons8-usuário-30.png" alt="">
                        <p id="nameUser">Admin</p>
                    </div>
                </div>
            </div>

            <div class="kanban-container">
                <div class="kanban-column">
                    <div class="kanban-header">Domingo</div>
                    <div class="kanban-content" id="Domingo">
                    </div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-header">Segunda-feira</div>
                    <div class="kanban-content" id="Segunda">

                    </div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-header">Terça-feira</div>
                    <div class="kanban-content" id="Terca">

                    </div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-header">Quarta-feira</div>
                    <div class="kanban-content" id="Quarta">

                    </div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-header">Quinta-feira</div>
                    <div class="kanban-content" id="Quinta">

                    </div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-header">Sexta-feira</div>
                    <div class="kanban-content" id="Sexta">

                    </div>
                </div>
                <div class="kanban-column">
                    <div class="kanban-header">Sábado</div>
                    <div class="kanban-content" id="Sabado">
                    </div>
                </div>
            </div>

        </div>


    </div>

    <!-- Modal Visualização -->
    <div id="modais-view">
        <!-- <div id="myModal-view" class="modal">
            <div class="modal-content">
                <span class="close-view" style="align-self: flex-end; font-size: 10vh; cursor: pointer; font-weight: bolder;"> X</span>
                <h2>Ação #010203</h2>
                <i>Cestas básicas para XPTO</i>
                <h3>Data prevista para acontecer: </h3> Terça-feira, 12/12/2000
                <h3>Descrição: </h3>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Eveniet, nostrum? Voluptatem, eum impedit inventore ex fugiat ratione quasi vitae voluptas optio veniam odit qui ducimus deserunt placeat nobis ea exercitationem?Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptates ea incidunt unde optio voluptatibus culpa impedit, perferendis qui soluta error dignissimos quae eum fuga minima, officia eos magnam, numquam possimus! Lorem, ipsum dolor sit amet consectetur adipisicing elit. 
                <div class="modal-acoes">
                    <div class="modal-acao">
                        <img src="./assets/imgs/icons8-lápis-24.png" alt="">
                        Editar
                    </div>
                    <div class="modal-acao">
                        <img src="./assets/imgs/icons8-lixo-24.png" alt="">
                        Excluir
                    </div>
                </div>
                
            </div>
        </div> -->
    </div>

    <!-- Modal Adição -->
    <div id="myModal_add" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Adicionar Ação</h2>
            <form>

                <div class="form-column">
                    <label for="tipoDoacao">Tipo da Doação</label>
                    <select id="tipoDoacao_add" name="tipoDoacao">
                        <option value="cestaBasica">Cesta Básica</option>
                        <option value="agasalho">Agasalho</option>
                        <option value="sopao">Sopão</option>
                        <option value="higiene">Itens de Higiene</option>
                    </select>

                    <label for="nomeAcao">Nome da Ação</label>
                    <input placeholder="Digite o nome da ação" type="text" id="nomeAcao_add" name="nomeAcao" required>

                    <label for="descricaoAcao">Descrição da Ação</label>
                    <textarea placeholder="Digite a descrição da ação" id="descricaoAcao_add" name="descricaoAcao"
                        rows="4" required></textarea>
                </div>

                <div class="form-column">
                    <label for="dataHoraInicio">Data e Hora de Início</label>
                    <input type="datetime-local" id="dataHoraInicio_add" name="dataHoraInicio" required>

                    <label for="dataHoraFim">Data e Hora de Fim</label>
                    <input type="datetime-local" id="dataHoraFim_add" name="dataHoraFim" required>

                    <label for="mapa-select">Endereço</label>
                    <button id="mapa-select" onclick="openModalEndereco()">
                        <img src="./assets/imgs/location.png" width="auto" height="20" alt="">
                        Selecionar no mapa
                    </button>

                    <button id="add-acao" type="submit" onclick="salvarCalendario()">Adicionar</button>

                </div>

            </form>
        </div>
    </div>

    <!-- Modal Endereço -->
    <div id="myModal_endereco" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Selecione o Endereço no Mapa</h2>
            <div id="map"></div>

            <!-- Botão de salvar endereço -->
            <button id="salvar-endereco" onclick="salvarEndereco()">
                Salvar endereço
            </button>

        </div>
    </div>

    <!-- Modal Edição -->
    <div id="myModal_edit" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Editar Ação</h2>
            <form>

                <div class="form-column">
                    <label for="tipoDoacao">Tipo da Doação</label>
                    <select id="tipoDoacao_edit" name="tipoDoacao">
                        <option value="cestaBasica">Cesta Básica</option>
                        <option value="agasalho">Agasalho</option>
                        <option value="sopao">Sopão</option>
                        <option value="higiene">Itens de Higiene</option>
                    </select>

                    <label for="nomeAcao">Nome da Ação</label>
                    <input placeholder="Digite o nome da ação" type="text" id="nomeAcao_edit" name="nomeAcao" required>

                    <label for="descricaoAcao">Descrição da Ação</label>
                    <textarea placeholder="Digite a descrição da ação" id="descricaoAcao_edit" name="descricaoAcao"
                        rows="4" required></textarea>
                </div>

                <div class="form-column">
                    <label for="dataHoraInicio">Data e Hora de Início</label>
                    <input type="datetime-local" id="dataHoraInicio_edit" name="dataHoraInicio" required>

                    <label for="dataHoraFim">Data e Hora de Fim</label>
                    <input type="datetime-local" id="dataHoraFim_edit" name="dataHoraFim" required>

                    <button id="add-acao" type="submit" onclick="editarCalendario()">Salvar Alterações</button>
                </div>

            </form>
        </div>
    </div>

    <!-- Menu de acessibilidade -->
    <div class="acessibility">
        <img src="./assets/imgs/icons8-acessibilidade-40.png" alt="" />
        <div class="options">
            <p>Aumentar Fonte</p>
            <p>Diminuir Fonte</p>
            <p onclick="altoContraste()">Alto-contraste</p>
        </div>
    </div>

    <!-- inserção do VLibras :) -->
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</body>

<!-- inserção do VLibras - leitor e tradutor para acessiblidade :) -->
<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
<script>
    new window.VLibras.Widget('https://vlibras.gov.br/app');
</script>

<script>

    /* FUNÇÕES PARA MODAL DE ENDEREÇO E LEAFTMAP :) */

    let isAddresSave = false

    function openModalEndereco() {

        var modal = document.getElementById("myModal_endereco");
        modal.style.display = "flex";
    }

    var chosenLocation;

    function closeModalEndereco() {
        var modal = document.getElementById("myModal_endereco");
        modal.style.display = "none";

        if(isAddresSave){
        var buttonContent = document.getElementById("mapa-select");

    buttonContent.innerHTML = `<img src="./assets/imgs/location.png" width="auto" height="20" alt="">Selecionar no mapa`
}
        
    }


    var closeBtn = document.querySelector("#myModal_endereco .close");
    closeBtn.onclick = function () {
        closeModalEndereco();
    };


    window.onclick = function (event) {
        var modal = document.getElementById("myModal_endereco");
        if (event.target == modal) {
            closeModalEndereco();
        }
    };

    // coordenadas da mooca solidaria p inicializar com o raio prox à ong
    var map = L.map('map').setView([-23.563084, -46.598206], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19
    }).addTo(map);

    

    map.on('click', function (e) {

        chosenLocation = e.latlng;

        L.marker(chosenLocation).addTo(map)
            .bindPopup('Local escolhido: ' + chosenLocation.lat + ', ' + chosenLocation.lng)
            .openPopup();

    });


    function salvarEndereco() {
        
        var buttonContent = document.getElementById("mapa-select")

                buttonContent.innerHTML = `
        <img src="./assets/imgs/location.png" width="auto" height="20" alt="">
        Coordenadas: ${chosenLocation.lat}, ${chosenLocation.lng}`
        
        isAddresSave = true

        closeModalEndereco()
    
    }


    // Ações

    function adicionarAcao() {

        // Encontra o elemento de adicionar ação
        var adicionarAcao = document.querySelectorAll('.adicionar-acao');

        // Adiciona um evento de clique a cada elemento encontrado
        adicionarAcao.forEach(function (element) {

            element.addEventListener('click', function () {

                // Exibe o modal quando clicado

                var modal = document.getElementById("myModal_add");

                modal.style.display = "block";

            });

        });

        // Encontra o elemento para fechar o modal
        var span = document.getElementsByClassName("close")[0];

        // Fecha o modal quando clicado no botão de fechar
        span.onclick = function () {
            var modal = document.getElementById("myModal_add");
            modal.style.display = "none";
        };

        // Fecha o modal se o usuário clicar fora dele
        window.onclick = function (event) {

            var modal = document.getElementById("myModal_add");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

    }

    function modal(idModal, idAcao, isSpan) {
        // pega o modal
        var modal = document.getElementById(idModal);

        // pega o botão que abre o modal
        var btns = document.getElementById(idAcao);

        // pega o elemento <span> que fecha o modal
        var span = document.getElementById(isSpan);

        // quando o usuário clicar em qualquer .inner-box abre o modal 

        btns.onclick = function () {
            modal.style.display = "block";
        }


        // quando o usuário clicar em <span> (x), fecha o modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // quando o usuário clicar em qualquer lugar fora do modal, fecha o modal
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    }

    function carregarInformacoes() {

        ListarCalendario()
        ListarTipos()

        var nomeUser = document.getElementById('nameUser');
        nomeUser.innerHTML = sessionStorage.getItem('NOME_USER')

    }

    function teste() {

        let dataCriacao = document.getElementById('dataHoraInicio')

        let datetime = dataCriacao.value

        console.log(datetime)

        let time = dataCriacao.value.slice(11)

        let hora = parseInt(time.slice(0, 2))
        let minutos = parseInt(time.slice(3))

        let data = dataCriacao.value.slice(0, 10)

        let ano = data.slice(0, 4)
        let mes = data.slice(5, 7)
        let dia = data.slice(8)

        console.log(data)
        console.log(ano)
        console.log(mes)
        console.log(dia)

    }

    // menu hamburger responsividade
    document.addEventListener('DOMContentLoaded', (event) => {
        const hamburgerMenu = document.getElementById('hamburger-menu');
        const sidebar = document.querySelector('.sidebar');
        const content = document.querySelector('.content');

        hamburgerMenu.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            content.classList.toggle('shift');
        });

        window.addEventListener('click', (event) => {
            if (!sidebar.contains(event.target) && !hamburgerMenu.contains(event.target)) {
                sidebar.classList.remove('active');
                content.classList.remove('shift');
            }
        });
    });



    /* função para abrir/fechar menu de acessibilidade */
    document.querySelector('.acessibility').addEventListener('click', function () {
        var optionsMenu = this.querySelector('.options');
        if (optionsMenu.style.display === 'flex') {
            optionsMenu.style.display = 'none';
        } else {
            optionsMenu.style.display = 'flex';
        }
    });

    /* adicionando a acessibilidade de alto contraste */
    function altoContraste() {
        document.body.classList.toggle('high-contrast');
    };



</script>



</html>